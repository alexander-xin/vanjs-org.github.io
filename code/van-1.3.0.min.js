let t,e,r,l,o,s=Object,n=s.getPrototypeOf,f=document,i={isConnected:1},a={},h=n(i),_=n(n),d=(t,e,r,l)=>(t??(setTimeout(r,l),new Set)).add(e),u=(t,e,l)=>{let o=r;r=e;try{return t(l)}catch(t){return console.error(t),l}finally{r=o}},g=t=>t.filter(t=>t.t?.isConnected),w=e=>o=d(o,e,()=>{for(let t of o)t.l=g(t.l),t.o=g(t.o);o=t},1e3),S={get val(){return r?.i?.add(this),this.h},get oldVal(){return r?.i?.add(this),this.u},set val(l){if(r?.S?.add(this),l!==this.h){this.h=l;let r=[...this.o=g(this.o)];for(let e of r)x(e.f,e.s,e.t),e.t=t;this.l.length?e=d(e,this,p):this.u=l}}},c=t=>({__proto__:S,h:t,u:t,l:[],o:[]}),v=t=>n(t??0)===S,y=(t,e)=>{let r={i:new Set,S:new Set},o={f:t},s=l;l=[];let n=u(t,r,e);n=(n??f).nodeType?n:new Text(n);for(let t of r.i)r.S.has(t)||(w(t),t.l.push(o));for(let t of l)t.t=n;return l=s,o.t=n},x=(t,e=c(),r)=>{let o={i:new Set,S:new Set},s={f:t,s:e};s.t=r??l?.push(s)??i,e.val=u(t,o,e.h);for(let t of o.i)o.S.has(t)||(w(t),t.o.push(s));return e},V=(e,...r)=>{for(let l of r.flat(1/0)){let r=n(l??0),o=r===S?y(()=>l.val):r===_?y(l):l;o!=t&&e.append(o)}return e},b=e=>new Proxy((r,...l)=>{let[o,...i]=n(l[0]??0)===h?l:[{},...l],d=e?f.createElementNS(e,r):f.createElement(r);for(let[e,l]of s.entries(o)){let o=r=>r?s.getOwnPropertyDescriptor(r,e)??o(n(r)):t,f=r+","+e,i=a[f]??(a[f]=o(n(d))?.set??0),h=e.startsWith("on")?(t,r)=>{let l=e.slice(2);d.removeEventListener(l,r),d.addEventListener(l,t)}:i?i.bind(d):d.setAttribute.bind(d,e),u=n(l??0);u===_&&(!e.startsWith("on")||l.v)&&(l=x(l),u=S),u===S?y(()=>(h(l.val,l.u),d)):h(l)}return V(d,...i)},{get:(e,r)=>e.bind(t,r)}),m=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),p=()=>{let r=[...e].filter(t=>t.h!==t.u);e=t;for(let e of new Set(r.flatMap(t=>t.l=g(t.l))))m(e.t,y(e.f,e.t)),e.t=t;for(let t of r)t.u=t.h};export default{add:V,_:t=>(t.v=1,t),tags:b(),tagsNS:b,state:c,val:t=>v(t)?t.val:t,oldVal:t=>v(t)?t.oldVal:t,derive:x,hydrate:(t,e)=>m(t,y(e,t))};